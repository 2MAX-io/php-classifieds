<script type="text/javascript">
    let cascader = {};
    cascader.currentLevel = 0;
    cascader.clickedLevel = 0;

    cascader.select = function (selectionId, clicked) {
        let $clicked = $(clicked);
        let $branchList = $mainElement.find('.cascader-branch-list-' + selectionId);
        let hasChildren = $branchList.length > 0;

        cascader.clickedLevel = $clicked.parents('.cascader-level').data('cascader-level');

        let newLevel = null;
        if (hasChildren) {
            newLevel = $branchList.parents('.cascader-level').data('cascader-level');
            $branchList.parents('.cascader-level').find('.cascader-branch-list').hide();
            $branchList.show();
        } else {
            newLevel = $clicked.parents('.cascader-level').data('cascader-level');
            cascader.onLeafSelection(selectionId);
        }

        if (newLevel < cascader.currentLevel) {
            cascader.hideLowerLevels();
        }

        cascader.currentLevel = newLevel;
        cascader.removeSelection();
        $clicked.addClass('cascader-selected');

    };

    cascader.hideLowerLevels = function() {
        let level = cascader.currentLevel;
        while ($mainElement.find('.cascader-level.cascader-level-'+level).length) {
            $mainElement.find('.cascader-level.cascader-level-"'+level+' .cascader-branch-list').hide();
            level += 1;
        }
    };

    cascader.removeSelection = function() {
        let level = cascader.clickedLevel;
        while ($mainElement.find('.cascader-level.cascader-level-'+level).length) {
            $mainElement.find('.cascader-level.cascader-level-'+level+' .cascader-selected').removeClass('cascader-selected');
            level += 1;
        }
    };

    cascader.setValue = function (leafId) {
        let $leaf = $mainElement.find('.cascader-leaf-' + leafId);
        let parenLeafId = 0;
        let $parentLeaf = null;
        do {
            let $branchList = $leaf.parents('.cascader-branch-list');

            $leaf.addClass('cascader-selected');
            $branchList.show();

            parenLeafId = $branchList.data('cascader-leaf');
            $parentLeaf = $mainElement.find('.cascader-leaf-' + parenLeafId);
            $leaf = $parentLeaf;
        } while ($parentLeaf.length);
    };

    cascader.selectValueFromForm = function() {
        cascader.setValue($('.formCategory').val());
    };

    cascader.onLeafSelection = function(leafId) {
        $('.formCategory').val(leafId);
    };

    let $mainElement = $('#cascader-category-select');
    $mainElement.show();
    $mainElement.find('.cascader-branch-list').first().show();
    cascader.selectValueFromForm();
</script>
