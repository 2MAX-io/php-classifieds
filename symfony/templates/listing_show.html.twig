{% extends 'base.html.twig' %}

{% block title %}{{ listing.title }}{% endblock %}

{% block body %}

    <div class="container mt-3 mb-3">
        <a href="//www.jaslo4u.pl">Jaslo4u.pl</a>
        > <a href="{{ path('app_index') }}">{{ 'trans.Classifieds' | trans }}</a>

        {% for category in categoryBreadcrumbs %}
            &gt; <a href="{{ path('app_category', {'categorySlug': category.slug}) }}">{{ category.name }}</a>
        {% endfor %}

        > {{ listing.title }}
    </div>

    <div class="container mt-3 tpl-listing-show">
        <div class="row">
            <div class="col-md-7">
                <div class="row mb-3">
                    <div class="col-sm-10">
                        <h1 class="user-text-wrap">{{ listing.title }}</h1>
                    </div>
                </div>

                <div class="mb-2">
                    {% if listing.listingFiles is not empty %}
                        <div class="owl-carousel">
                            {% for listingFile in listing.listingFiles %}
                                <a href="{{ asset(listingFile.pathNormalSize) }}" data-toggle="lightbox" data-gallery="multiimages" data-title="{{ listing.title }}">
                                    <img
                                            src="{{ asset(listingFile.pathNormalSize) }}"
                                            class="mx-auto listing-show-top-image"
                                            alt="{{ listing.title }}"
                                    />
                                </a>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Tabs nav -->
                <ul class="nav nav-tabs flex-column flex-sm-row" id="myTab" role="tablist">
                    <li class="nav-item flex-sm-fill text-sm-center">
                        <a href="#overview" class="nav-link active" aria-controls="overview" role="tab" data-toggle="tab" aria-selected="true">{{ 'trans.Ad Details' | trans }}</a>
                    </li>

                    {% if listing.listingFiles.count > 0 %}
                        <li class="nav-item flex-sm-fill text-sm-center">
                            <a href="#photos" class="nav-link" aria-controls="photos" role="tab" data-toggle="tab">{{ 'trans.Photos' | trans }} ({{ listing.listingFiles.count }})</a>
                        </li>
                    {% endif %}
                </ul>

                <!-- Tabs contents -->
                <div class="tab-content p-3 rounded-bottom">
                    <!-- tab overview -->
                    <div class="tab-pane fade show active" role="tabpanel" id="overview">

                        <div class="row">
                            {% for listingCustomFieldValue in listing.listingCustomFieldValues %}
                                {# @var listingCustomFieldValue \App\Entity\ListingCustomFieldValue #}
                                <div class="mb-2 py-2 col-md-4">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <strong>{{ listingCustomFieldValue.customField.name }}:&nbsp;</strong>
                                            {% if listingCustomFieldValue.customFieldOption is empty %}
                                                <span>{{ listingCustomFieldValue.value }}</span>
                                            {% else %}
                                                <span>{{ listingCustomFieldValue.customFieldOption.name }}</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                        <div class="zebra">
                            <!-- description -->
                            <div class="block">
                                <div class="user-text-wrap px-3 mb-3 mt-2">
                                    {{ listing.description | nl2br }}
                                </div>
                                <div class="px-3 py-1 clearfix">
                                    <div class="float-md-right">
                                        {{ 'trans.Views' | trans }}: {{ listingShowDto.viewsCount+1 }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- end div class zebra -->
                    </div>
                    <!-- end tab overview -->

                    <!-- Tab photos -->
                    <div id="photos" class="tab-pane fade clearfix" role="tabpanel">
                        {% for listingFile in listing.listingFiles %}
                            <div class="listing-thumb float-left img-thumbnail mr-2 mb-2" style="width: 120px">
                                <a href="{{ asset(listingFile.pathNormalSize) }}" data-toggle="lightbox" data-gallery="multiimages" data-title="{{ listing.title }}">
                                    <div class="dummy container-img rounded" style="background-image:url('{{ asset(listingFile.pathNormalSize) }}');"></div>
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    <!-- End tab photos -->
                </div>

                {% if listing.listingFiles is not empty %}
                    <div class="my-2">
                        {% for listingFile in listing.listingFiles %}
                            <a href="{{ asset(listingFile.pathNormalSize) }}" data-toggle="lightbox" data-gallery="multiimages" data-title="{{ listing.title }}">
                                <img class="mb-2" src="{{ asset(listingFile.pathNormalSize) }}" alt="{{ listing.title }}" />
                            </a>
                        {% endfor %}
                    </div>
                {% endif %}

                <div>
                    {{ 'trans.Listing identifier' | trans }}: {{ listing.id }}
                </div>

                <!-- end tabs contents -->
            </div>

            <!-- Sidebar -->
            <div class="col-md-5">
                {% if isCurrentUserListing(listing) %}
                    <a href="{{ path('app_listing_edit', {'id': listing.id}) }}" class="btn btn-primary mb-1">{{ 'trans.Edit listing' | trans }}</a>
                {% endif %}

                {% if lowSecurityCheckIsAdminInPublic() %}
                    <a
                            href="{{ path('app_admin_listing_edit', {'id': listing.id}) }}"
                            class="btn btn-outline-danger mb-1"
                    >
                        {{ 'trans.Edit listing as Admin' | trans }}
                    </a>
                {% endif %}

                {% if listing.price is not empty %}
                    <div>
                        <div class="my-1">
                            <h3 class="btn btn-dark price btn-lg">{{ 'trans.Price' | trans }}: {{ listing.price }}</h3>
                        </div>
                    </div>
                {% endif %}

                {# Informations #}
                <div class="card mb-3" style="width: 100%;">
                    <div class="card-header">
                        <h5>{{ 'trans.Informations' | trans }}</h5>
                    </div>

                    <div class="card-body">
                        {% if listing.phone is not empty %}
                        <div class="mb-2 py-2">
                            <div class="row">
                                <div class="col-sm-4">{{ 'trans.Phone' | trans }}</div>

                                <div class="col-sm-8">
                                    <a href="tel:{{ listing.phone }}">{{ listing.phone }}</a>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if listing.email is not empty and listing.emailShow %}
                        <div class="mb-2 py-2">
                            <div class="row">
                                <div class="col-sm-4">{{ 'trans.Email' | trans }}</div>

                                <div class="col-sm-8">
                                    <a target="_blank" href="mailto:{{ listing.email }}">{{ listing.email }}</a>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if listing.city is not empty %}
                            <div class="mb-2 py-2">
                                <div class="row">
                                    <div class="col-sm-4">{{ 'trans.City' | trans }}</div>

                                    <div class="col-sm-8">
                                        {{ listing.city }}
                                    </div>
                                </div>
                            </div>
                        {% endif %}

                        <div class="mb-2 py-2">
                            <div class="row">
                                <div class="col-sm-4">{{ 'trans.Date added' | trans }}</div>

                                <div class="col-sm-8">
                                    {{ listing.orderByDate | date }}
                                </div>
                            </div>
                        </div>

                        <div class="mb-2 py-2">
                            <div class="row">
                                <div class="col-sm-4">{{ 'trans.Expiration date' | trans }}</div>

                                <div class="col-sm-8">
                                    {{ listing.validUntilDate | date }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <a href="{{ path('app_user_listings', {"user": listing.user.id}) }}" class="btn btn-sm btn-dark btn-block mt-auto">
                            {{ 'trans.User listings' | trans }}
                        </a>
                    </div>
                </div>

                <!-- Share listing -->
                <div class="card mb-3" style="width: 100%;">
                    <div class="card-header">
                        <h5>{{ 'trans.Share This Listing' | trans }}</h5>
                    </div>

                    <div class="card-body">
                        <div class="fb-share-button"
                             data-href="{{ absolute_url('app_listing_show', {'id': listing.id, 'slug': listing.slug}) }}"
                             data-layout="button"
                             data-size="small"
                             data-mobile-iframe="true"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u={{ absolute_url('app_listing_show', {'id': listing.id, 'slug': listing.slug}) }}&src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a>
                        </div>

                        <a class="twitter-share-button" href="https://twitter.com/intent/tweet?url={{ absolute_url('app_listing_show', {'id': listing.id, 'slug': listing.slug}) }}&text={{ listing.title }}">Tweet</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock body %}

{% block js %}
    <link rel="stylesheet" href="{{ asset('asset/lib/lightbox-master/dist/ekko-lightbox.css') }}">
    <link rel="stylesheet" href="{{ asset('asset/lib/owl-carusel/assets/owl.carousel.css') }}">
    <script src="{{ asset('asset/lib/lightbox-master/dist/ekko-lightbox.min.js') }}"></script>
    <script src="{{ asset('asset/lib/owl-carusel/owl.carousel.js') }}"></script>

    <script type="text/javascript">
        $(document).ready(function(){
            // lightbox
            $(document).delegate('*[data-toggle="lightbox"]', 'click', function(event) {
                event.preventDefault();
                $(this).ekkoLightbox();
            });
        });

        $('.owl-carousel').owlCarousel({
            center: true,
            nav: true,
            navText : ['<i class="fa fa-angle-left" aria-hidden="true"></i>','<i class="fa fa-angle-right" aria-hidden="true"></i>'],
            checkVisible: false,
            items: 1
        });
    </script>

{% endblock %}

