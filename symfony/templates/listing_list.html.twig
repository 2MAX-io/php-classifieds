{% extends 'base.html.twig' %}

{% block title %}{{ pageTitle }}{% endblock %}

{% block body %}

    <div class="container mt-3 mb-3">
        <a href="//www.jaslo4u.pl">Jaslo4u.pl</a>
        > <a href="{{ path('app_index') }}">{{ 'trans.Classifieds' | trans }}</a>

        {% for category in categoryBreadcrumbs %}
            &gt; <a href="{{ path('app_category', {'categorySlug': category.slug}) }}">{{ category.name }}</a>
        {% endfor %}

        {% if breadcrumbLast is not empty %}
            &gt; {{ breadcrumbLast }}
        {% endif %}
    </div>

    <div class="container mt-md-5">
        <div class="row">
            <!-- Sidebar & Advanced Filters -->
            <div class="col-12 d-md-none">
                <button
                        class="btn btn-secondary btn-sm mb-2 w-100"
                        data-toggle="collapse"
                        data-target="#filters"
                >
                    {{ 'trans.Show filters' | trans }}
                </button>
            </div>

            <div class="col-md-3 d-none-soft d-md-block collapse" id="filters">
                {% if categoryList is not empty %}
                    <div class="card mb-3">
                        <div class="card-header">
                            <strong>{{ 'trans.Category' | trans }}</strong>
                        </div>
                        <div class="card-body">
                            {% for category in categoryList %}
                                <a
                                        href="{{ path('app_category', {'categorySlug': category.slug} | merge(queryParameters)) }}"
                                        class="py-1 d-block listing-list-side-category category-link {% if listingListDto.category and category.slug == listingListDto.category.slug  %}active{% endif %}"
                                >{{ category.name }}</a>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}

                <div class="card mb-3">
                    <div class="card-header">
                        <strong>{{ 'trans.Refine Search' | trans }}</strong>
                    </div>

                    <div class="card-body">
                        <form method="get" id="" action="">
                            <div class="mb-3">
                                <div class="input-group mb-2 mr-2">
                                    <div class="input-group-prepend">
                                        <div class="input-group-text"><i class="fas fa-search"></i></div>
                                    </div>

                                    <input
                                            type="text"
                                            class="form-control"
                                            name="query"
                                            placeholder="{{ 'trans.keyword'|trans }}"
                                            value="{{ app.request.get('query') | default }}"
                                    >
                                </div>
                            </div>

                            {% if app.request.get('user') is not empty %}
                                <div class="mb-3" id="li-field-7">
                                        <div class="custom-control custom-checkbox">
                                            <input
                                                    name="user"
                                                    value="{{ app.request.get('user') }}"
                                                    checked
                                                    type="checkbox"
                                                    id="option_user"
                                                    class="custom-control-input"
                                            >
                                            <label class="custom-control-label" for="option_user">{{ 'trans.User Listings' | trans }}</label>
                                        </div>
                                </div>
                            {% endif %}

                            {# @var customField \App\Entity\CustomField #}
                            {% for customField in customFieldList %}
                                {% if customField.type == constant('\App\\Entity\\CustomField::TYPE_SELECT') and customField.customFieldOptions is not empty %}
                                    <div class="mb-3" id="li-field-7">
                                        <p><strong>{{ customField.name }}</strong></p>

                                        {% for customFieldOption in customField.customFieldOptions %}
                                            <div class="custom-control custom-checkbox">
                                                <input
                                                    name="form_custom_field[{{ customField.id }}][values][]"
                                                    value="{{ customFieldOption.value }}"
                                                    {% if customFieldOption.value in app.request.get('form_custom_field')[customField.id]['values'] | default([]) %}
                                                        {{- 'checked' -}}
                                                    {% endif %}
                                                    type="checkbox"
                                                    id="option_{{ customFieldOption.id }}"
                                                    class="custom-control-input"
                                                >
                                                <label
                                                        class="custom-control-label"
                                                        for="option_{{ customFieldOption.id }}"
                                                >
                                                    {{ customFieldOption.name }}
                                                </label>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                {% if customField.type in [
                                        constant('\App\\Entity\\CustomField::TYPE_INTEGER_RANGE'),
                                        constant('\App\\Entity\\CustomField::TYPE_YEAR_RANGE'),
                                    ]
                                %}
                                    <label>{{ customField.name }}</label>
                                    <div class="form-row mb-3">
                                        <div class="col-6">
                                            <input
                                                name="form_custom_field[{{ customField.id }}][range][min]"
                                                value="{{ app.request.get('form_custom_field')[customField.id]['range']['min'] | default }}"
                                                type="text"
                                                placeholder="{{ 'trans.min' | trans }}"
                                                class="form-control form-control-sm">
                                        </div>

                                        <div class="col-6">
                                            <input
                                                name="form_custom_field[{{ customField.id }}][range][max]"
                                                value="{{ app.request.get('form_custom_field')[customField.id]['range']['max'] | default }}"
                                                type="text"
                                                placeholder="{{ 'trans.max' | trans }}"
                                                class="form-control form-control-sm"
                                            >
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}

                            <!-- price -->
                            <label>{{ 'trans.Amount or price' | trans }}</label>
                            <div class="form-row mb-3">
                                <div class="col-6">
                                    <input
                                            type="text"
                                            id="min_price"
                                            class="form-control"
                                            name="min_price"
                                            value="{{ app.request.get('min_price') | default }}"
                                            placeholder="{{ 'trans.amount min' | trans }}"
                                    >
                                </div>

                                <div class="col-6">
                                    <input
                                            type="text"
                                            id="max_price"
                                            class="form-control"
                                            name="max_price"
                                            value="{{ app.request.get('max_price') | default }}"
                                            placeholder="{{ 'trans.amount max' | trans }}"
                                    >
                                </div>
                            </div>

                            <button class="btn btn-primary w-100">{{ 'trans.Filter' | trans }}</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Listings Col -->
            <div class="col-md-9 item-list">

                <!-- sort and display -->
{#                <ul class="nav justify-content-end mb-1">#}
{#                    <li class="nav-item">#}
{#                        <div class="dropdown">#}
{#                            <button class="btn btn-sm btn-light dropdown-toggle mr-1" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">#}
{#                                Sort						</button>#}
{#                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">#}
{#                                <a class="dropdown-item" href="?sort=price-asc">Price Asc</a>#}
{#                                <a class="dropdown-item" href="?sort=price-desc">Price Desc</a>#}
{#                                <a class="dropdown-item" href="?sort=date-asc">Date Asc</a>#}
{#                                <a class="dropdown-item" href="?sort=date-desc">Date Desc</a>#}
{#                            </div>#}
{#                        </div>#}
{#                    </li>#}
{#                    <li class="nav-item">#}
{#                        <button id="grid-view" class="btn btn-sm btn-light mr-1"><i class="fas fa-th"></i></button>#}
{#                    </li>#}
{#                    <li class="nav-item">#}
{#                        <button id="list-view" class="btn btn-sm btn-light"><i class="fas fa-th-list"></i></button>#}
{#                    </li>#}
{#                </ul>#}

                <!-- the listings -->
                <div id="cards-wrapper">
                    {% for listing in listingList %}
                        <div
                                id="listing-{{ listing.id }}"
                                class="card mb-3 regular {% if listing.featured %}listing-recommended{% endif %}"
                        >
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="card-thumb col-12 col-md-3 pt-3 pb-md-3">
                                        <a
                                                title="{{ listing.title }}"
                                                href="{{ path('app_listing_show', {id: listing.id, 'slug': listing.slug}) }}"
                                        >
                                        <img
                                                    class="rounded listing-list-img"
                                                    alt="{{ listing.title }}"
                                                    src="{{ asset(listing.mainImageInListSize | default('static/system/blank.png')) }}"
                                            >
                                        </a>
                                    </div>

                                    <div class="card-text col-12 col-md-9 pb-3 pt-sm-3">
                                        {% if listing.featured %}
                                            <div class="pt-3 pt-sm-0 float-right">
                                                <span class="badge badge-pill badge-warning">{{ 'trans.Recommended' | trans }}</span>
                                            </div>
                                        {% endif %}

                                        <h5 class="pt-3 pt-sm-0">
                                            <strong>
                                                <a href="{{ path('app_listing_show', {id: listing.id, 'slug': listing.slug}) }}">
                                                    {{ listing.title }}
                                                </a>
                                            </strong>
                                        </h5>

                                        <div>
                                            {% if listing.city is not empty %}
                                                <span class="mr-1">
                                                    <i class="fas fa-map-marker-alt text-danger"></i>
                                                    {{ listing.city }}
                                                </span>
                                            {% endif %}

                                            <span class="mr-1">
                                                <i class="fas fa-calendar text-black-50"></i>
                                                {{ listing.orderByDate | date }}
                                            </span>
                                        </div>

                                        {% if listing.price is not empty %}
                                            <div class="mt-1">
                                                <span class="btn btn-dark btn-sm price">
                                                    {{ 'trans.Price' | trans }}:
                                                    {{ listing.price | money }}
                                                </span>

                                                {% if listing.priceFor %}
                                                    <span>{{ ('trans.priceFor.'~listing.priceFor) | trans }}</span>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>

                {% include 'base/_pagination.html.twig' %}
            </div>
        </div>
    </div>

{% endblock body %}
