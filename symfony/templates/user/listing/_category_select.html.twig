<script type="text/javascript">
    let cascader = {};
    cascader.$mainElement = $('#cascader-category-select');
    cascader.currentLevel = 0;
    cascader.clickedLevel = 0;

    cascader.select = function (selectionId, clicked) {
        let $clicked = $(clicked);
        let $branchList = cascader.$mainElement.find('.cascader-branch-list-' + selectionId);
        let hasChildren = $branchList.length > 0;

        cascader.clickedLevel = $clicked.parents('.cascader-level').data('cascader-level');

        let newLevel = null;
        if (hasChildren) {
            newLevel = $branchList.parents('.cascader-level').data('cascader-level');
            $branchList.parents('.cascader-level').find('.cascader-branch-list').hide();
            $branchList.show();
        } else {
            newLevel = $clicked.parents('.cascader-level').data('cascader-level');
            cascader.onLeafSelection(selectionId);
        }

        if (newLevel < cascader.currentLevel) {
            cascader.hideLowerLevels();
        }

        cascader.currentLevel = newLevel;
        cascader.removeSelection();
        $clicked.addClass('cascader-selected');

    };

    cascader.hideLowerLevels = function() {
        let level = cascader.currentLevel;
        while (cascader.$mainElement.find('.cascader-level.cascader-level-'+level).length) {
            cascader.$mainElement.find('.cascader-level.cascader-level-"'+level+' .cascader-branch-list').hide();
            level += 1;
        }
    };

    cascader.removeSelection = function() {
        let level = cascader.clickedLevel;
        while (cascader.$mainElement.find('.cascader-level.cascader-level-'+level).length) {
            cascader.$mainElement.find('.cascader-level.cascader-level-'+level+' .cascader-selected').removeClass('cascader-selected');
            level += 1;
        }
    };

    cascader.setValue = function (leafId) {
        if (leafId.length < 1) {
            return;
        }

        cascader.$mainElement.find('.cascader-selected').removeClass('cascader-selected');
        cascader.$mainElement.find('.cascader-branch-list').hide();
        let $leaf = cascader.$mainElement.find('.cascader-leaf-' + leafId);
        let parenLeafId = 0;
        let $parentLeaf = null;
        do {
            let $branchList = $leaf.parents('.cascader-branch-list');

            $leaf.addClass('cascader-selected');
            $branchList.show();

            parenLeafId = $branchList.data('cascader-leaf');
            $parentLeaf = cascader.$mainElement.find('.cascader-leaf-' + parenLeafId);
            $leaf = $parentLeaf;
        } while ($parentLeaf.length);
    };

    cascader.selectValueFromForm = function() {
        cascader.setValue($('.formCategory').val());
    };

    cascader.onLeafSelection = function(leafId) {
        $('.formCategory').val(leafId);
        $('.formCategory').trigger('change', leafId)
    };

    cascader.onFormChangeUpdateCascader = function() {
        $('.formCategory').on('change', function() {
            cascader.setValue(this.value);
        });
    };

    cascader.$mainElement.show();
    cascader.$mainElement.find('.cascader-branch-list').first().show();
    cascader.selectValueFromForm();
    cascader.onFormChangeUpdateCascader();
</script>
